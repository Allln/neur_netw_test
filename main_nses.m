clc
clear all
close all

%data
x = getx(); %fcn to mix traindata - faster learnin
%nonmixed train data
%{
xraw = [8.0598205e+00, -4.8233213e+00, 1.0000000e+00;
    7.2151551e+00, -4.6972317e+00, 1.0000000e+00;
    7.8856054e+00, -4.2159527e+00, 1.0000000e+00;
    6.6467538e+00, -4.8738496e+00, 1.0000000e+00;
    6.6210084e+00, -4.1680448e+00, 1.0000000e+00;
    7.4751599e+00, -5.4955389e+00, 1.0000000e+00;
    6.0871077e+00, -4.5066303e+00, 1.0000000e+00;
    7.7016085e+00, -4.3769255e+00, 1.0000000e+00;
    6.3121949e+00, -5.4437006e+00, 1.0000000e+00;
    7.8069369e+00, -4.5717144e+00, 1.0000000e+00;
    9.1868943e+00, 1.0924429e+01, 2.0000000e+00;
    8.9325564e+00, 1.0192356e+01, 2.0000000e+00;
    9.6854042e+00, 1.0616708e+01, 2.0000000e+00;
    8.8966651e+00, 1.0329920e+01, 2.0000000e+00;
    1.1130413e+01, 9.1703368e+00, 2.0000000e+00;
    9.6954312e+00, 9.9659265e+00, 2.0000000e+00;
    8.9135706e+00, 9.5925533e+00, 2.0000000e+00;
    9.7350619e+00, 1.1544071e+01, 2.0000000e+00;
    8.9341922e+00, 1.0443777e+01, 2.0000000e+00;
    9.0797461e+00, 1.1333853e+01, 2.0000000e+00;
    -3.4452738e+00, 1.6582872e+01, 3.0000000e+00;
    -3.3986404e+00, 1.6664912e+01, 3.0000000e+00;
    -3.0964997e+00, 1.6553308e+01, 3.0000000e+00; 
    -4.4782423e+00, 1.6821172e+01, 3.0000000e+00;
    -2.8151202e+00, 1.5926468e+01, 3.0000000e+00;
    -3.9332174e+00, 1.7291367e+01, 3.0000000e+00;
    -4.9734413e+00, 1.7056150e+01, 3.0000000e+00;
    -3.3161278e+00, 1.6800733e+01, 3.0000000e+00;
    -4.2605084e+00, 1.6663950e+01, 3.0000000e+00;
    -3.7251876e+00, 1.7248229e+01, 3.0000000e+00;
    -1.3692411e+01, 5.9155610e+00, 4.0000000e+00;
    -1.3099468e+01, 6.1011888e+00, 4.0000000e+00;
    -1.4607664e+01, 5.8608849e+00, 4.0000000e+00;
    -1.3571454e+01, 6.2537392e+00, 4.0000000e+00;
    -1.3552698e+01, 6.1756228e+00, 4.0000000e+00;
    -1.2561963e+01, 5.1000066e+00, 4.0000000e+00;
    -1.4361667e+01, 6.0804860e+00, 4.0000000e+00;
    -1.4048456e+01, 7.0355166e+00, 4.0000000e+00;
    -1.3967731e+01, 6.0614814e+00, 4.0000000e+00;
    -1.4061259e+01, 6.5986321e+00, 4.0000000e+00;
    -7.7005325e+00, -6.6591824e+00, 5.0000000e+00;
    -8.2434030e+00, -6.9875403e+00, 5.0000000e+00;
    -7.8569987e+00, -7.3434609e+00, 5.0000000e+00;
    -7.0979196e+00, -7.6362358e+00, 5.0000000e+00;
    -7.8862517e+00, -7.8785192e+00, 5.0000000e+00;
    -8.6547642e+00, -7.0326302e+00, 5.0000000e+00;
    -6.5521862e+00, -7.0514873e+00, 5.0000000e+00;
    -7.4181389e+00, -7.5876619e+00, 5.0000000e+00;
    -6.2914300e+00, -7.0933231e+00, 5.0000000e+00;
    -6.4707959e+00, -6.7142591e+00, 5.0000000e+00; ];
x = transpose(xraw); 
%}


%vars
syms X1 Y1
%docela dobry vysledky
%c = trenovaci konstanta
W(:,1) = rand(5, 1) * 100;
W(:,2) = rand(5, 1) * 100;
b = rand(5, 1) * 25;
c = 1;
%chyba
%{
W(:,1) = rand(5, 1) * 100000;
W(:,2) = rand(5, 1) * 2500000;
b = rand(5,1)*250;
c = 1;
%}

%W(:,1) = rand(5, 1) * 100;
%W(:,2) = rand(5, 1) * 100;
%b = rand(5, 1) * 25;
%c = 25;

E = 1;
cycl = 0;
k = 1;
Es = 1;
Ec = 0;
Ec2 = 0;

%testdata
testd = load('realtest.txt');
testd = testd.';

%trn
while Es > 0
    Es = 0;
    cycl = cycl + 1;
    %train eqs.
    for i = 1:size(x, 2)
        y = sign(W * x(1:2, i) + b);
        u = [-1;
             -1;
             -1;
             -1;
             -1];
        u(x(3, i)) = 1;
        E = 0.5 * (u - y).' * (u - y);
        W = W + c * (u - y) * x(1:2, i).';
        b = b + c * (u - y);
        Es = Es + sum(E);
        Ec(k) = Es;
    end
    Ec(k);
    x = getx(); % x = x if we want to use nonmixed trainset
    k = k + 1;
end

%trenovaci data
figure;
for i = 1:size(x, 2)
    switch x(3, i)
        case 1
            mark = '-s';
        case 2
            mark = '-x';
        case 3
            mark = '-p';
        case 4
            mark = '-h';
        case 5
            mark = '-d';
    end
    plot(x(1, i), x(2, i), mark);
    hold on
end
%
for j = 1:size(W, 1)
    i(j) = ezplot(W(j, 1) * X1 + W(j,2) * Y1 + b(j) == 0, [-30, 30, -30, 30]);
    title('Trenovaci data')
    ylabel('y')
    xlabel('x')
end

for i = 1:size(testd, 2)
    y = sign(W * testd(1:2, i) + b);
    u = [-1;
         -1;
         -1;
         -1;
         -1];
    u(testd(3, i)) = 1;
    Ec2(i) = sum(0.5 * (u-y).' * (u-y));
end

%test data
figure;
for i = 1:size(testd, 2)
    switch x(3,i)
    case 1
        mark = '-s';
    case 2
        mark = '-x';
    case 3
        mark = '-p';
    case 4
        mark = '-h';
    case 5
        mark = '-d';
    end
    plot(testd(1, i), testd(2, i), mark);
    hold on 
end

for j = 1:size(W,1)
    i(j) = ezplot(W(j, 1) * X1 + W(j, 2) * Y1 + b(j) == 0, [-30, 30, -30, 30]);
    title('Testovaci data')
    ylabel('y')
    xlabel('x')
end

%plot chyba

cyclvector = []
for i = 1:cycl
    cyclvector(i) = i;
end

figure
plot(cyclvector, Ec, "-+")
hold on
title('Vyvoj chyby')
ylabel('chyba')
xlabel('pocet cyklu')
grid on

%res
disp('prahovy vektor: ')
b
disp('vahova matice: ')
W
disp('pocet cyklu: ')
cycl